name: Compile fetch_token
on:
  #push:
  #  branches: [ main ]
  workflow_dispatch:

jobs:
#  build-windows:
#    runs-on: windows-latest
#    steps:
#    - uses: actions/checkout@v4
#    - uses: actions/setup-node@v4
#      with:
#        node-version: '20'
#    - run: npm -g install bun
#    - name: Compile fetch_token
#      working-directory: fetch_token
#      run: |
#        bun install
#        bun build ./fetch_token.js --compile --minify --outfile fetch_token.exe
#    - name: Commit & Push changes
#      uses: EndBug/add-and-commit@v9
#      with:
#        add: 'fetch_token/fetch_token.exe'
  build-macos:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: '20'
    - run: npm -g install bun
    - name: Compile fetch_token
      working-directory: fetch_token
      run: |
        bun install
        bun build ./fetch_token.js --compile --minify --outfile fetch_token.macos.bin
    - name: Commit & Push changes
      uses: EndBug/add-and-commit@v9
      with:
        add: 'fetch_token/fetch_token.macos.bin'
        pull: '--rebase --autostash'
  build-linux:
    needs: build-macos
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: '20'
    - run: npm -g install bun
    - name: Compile fetch_token
      working-directory: fetch_token
      run: |
        bun install
        bun build ./fetch_token.js --compile --minify --outfile fetch_token.linux.bin
    - name: Commit & Push changes
      uses: EndBug/add-and-commit@v9
      with:
        add: 'fetch_token/fetch_token.linux.bin'
        pull: '--rebase --autostash'
